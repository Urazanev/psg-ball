# Simple Pinball: подробный гайд по механикам, очкам, предметам и достижениям

Документ составлен по фактической логике проекта (скрипты и prefab-данные), а не по предположениям.

## 1) Как устроен игровой цикл

1. Нажатие `Play` запускает `GameStart()`:
- выдается достижение `Getting Started`;
- `Tilt = false`;
- `Lives = 4`;
- `Score = 0`.

2. Первый шар не спавнится мгновенно кнопкой `Play`.
- Спавн шара происходит в `Update()` игрока, когда поле пустое примерно `0.8` секунды.

3. Потеря шара:
- когда шар покидает триггер поля, он удаляется;
- если через `0.8` сек в поле нет ни одного шара, отнимается 1 жизнь (`Lives -= 1`), текущий предмет снимается, затем спавнится новый шар (если жизни не ушли в минус).

4. Конец игры:
- если после очередной потери `Lives < 0`, показывается `Game Over`.

## 2) Важный нюанс про жизни

- Игра стартует с `Lives = 4`, но активный шар уже существует в раунде.
- По факту это дает 5 попыток шара (текущий + 4 «в запасе»), после чего `Lives` уходит в `-1` и игра заканчивается.

## 3) Управление

- `Space` (удерживать/отпустить): плунжер (натяжение/выстрел).
- `A` или `Left Arrow`: левый флиппер.
- `D` или `Right Arrow`: правый флиппер.
- `Left Shift`: шевеление/толчок стола влево.
- `Right Shift`: шевеление/толчок стола вправо.
- `Left Ctrl` (или `Left Cmd` на macOS): использовать следующий предмет из инвентаря.
- `Esc`: пауза.

Если активировался `Tilt`, управление флипперами/толчками/активацией предмета блокируется до потери текущего шара (Tilt сбрасывается при следующем респавне).

## 4) Система очков

Очки начисляются при столкновениях шара с объектами, у которых есть `ScoringObject`:

- `Slingshot`: `+25`
- `Bumper`: `+50`
- `Flag`: `+61`

Формула добавки в счет:

```text
Добавка = floor(БазовыеОчкиОбъекта * ТекущийМножитель)
```

Пример:
- удар по Bumper при `x1.0` => `+50`
- удар по Bumper при `x2.3` => `+115`

## 5) Множитель очков

Базовое поведение:
- каждые `10` секунд, пока в поле есть хотя бы один движущийся шар, множитель растет на `+0.1`.

Сброс множителя:
- множитель сбрасывается в `1.0` каждый раз, когда меняется `Lives`.

Это происходит:
- при старте игры (`Lives = 4`),
- при смерти шара (`Lives -= 1`),
- при любом эффекте, который добавляет/изменяет жизни (например, `Health Bonus`, `Curse of Anubis`).

## 6) Толчок стола и Tilt

Параметры:
- сила толчка: `2` (применяется ко всем шарам в поле);
- базовый шанс Tilt: `1 из 5` (20%) на каждый толчок.

Логика:
- при `LSHIFT/RSHIFT` все шары получают импульс влево/вправо;
- затем случайно определяется Tilt.

Если Tilt случился:
- `Player.Tilt = true`;
- управление (кроме плунжера) блокируется до потери шара.

## 7) Плунжер (Space)

Параметры:
- `MaxForce = 16`
- `MinForce = 0`
- `IncreasingFactor = 0.2` на кадр удержания

Поведение:
- при удержании `Space` сила растет;
- если пересечь `MaxForce`, проигрывается fail-звук и сила режется случайным коэффициентом ~`0.5..0.7`;
- при отпускании `Space` накопленная сила применяется вперед к шарам, находящимся в зоне пружины.

## 8) Тикеты (Tickets) и экономика

### 8.1 Как зарабатываются тикеты

Есть пороговая логика, зависящая от очков и множителя:

```text
Если Score > lastTicketIncrement + (500 * Multiplier)
=> Tickets += 1
=> lastTicketIncrement += 500 * Multiplier
```

Детали:
- проверка строгая (`>`), не `>=`;
- за один апдейт счета можно получить максимум 1 тикет;
- тикеты сохраняются между сессиями (`PlayerPrefs` ключ `ticketCount`).

### 8.2 Магазин ящиков

Цены:
- Rusty Crate: `3` тикета
- Brass Crate: `6` тикетов
- Golden Crate: `10` тикетов

Покупка не пройдет, если:
- не хватает тикетов;
- все 3 слота инвентаря заняты.

При неудаче тикеты не списываются.

## 9) Инвентарь и активация предметов

- Инвентарь: 3 слота (очередь).
- Используется всегда **первый** слот.
- После использования слот-очередь сдвигается влево.

Ограничения использования:
- нужен хотя бы 1 шар в поле;
- нельзя активировать новый предмет, пока предыдущий еще «экипирован».

Длительность действия:
- предмет активен до следующей потери шара (когда вызовется `Inventory.Unequip()`).

Применение к шарам:
- в момент активации на все текущие шары может повеситься:
  - trail-материал,
  - визуальный материал шара,
  - физический материал шара.

## 10) Лут ящиков: точные шансы

### 10.1 Rusty Crate (суммарная incidence = 20)

- Fireball: `4/20 = 20%`
- Water Droplet: `4/20 = 20%`
- Camera Flip: `3/20 = 15%`
- Health Bonus: `1/20 = 5%`
- Ping Pong: `3/20 = 15%`
- Rock: `4/20 = 20%`
- Tennis Ball: `1/20 = 5%`

### 10.2 Brass Crate (суммарная incidence = 20)

- Fireball: `10%`
- Water Droplet: `5%`
- Lucky Charm: `20%`
- Curse of Anubis: `5%`
- Angel Wings: `10%`
- Camera Flip: `5%`
- Extra Ball: `15%`
- Health Bonus: `5%`
- Tennis Ball: `10%`
- Ticket Prize: `15%`

### 10.3 Golden Crate (суммарная incidence = 7)

- Curse of Anubis: `1/7 ≈ 14.29%`
- Angel Wings: `2/7 ≈ 28.57%`
- Extra Ball: `2/7 ≈ 28.57%`
- Health Bonus: `1/7 ≈ 14.29%`
- Ticket Prize: `1/7 ≈ 14.29%`

## 11) Все предметы: как работают реально

Ниже указано именно фактическое поведение из кода.

### 11.1 Fireball

- OnEquip: без дополнительной логики.
- Пассивно через материалы:
  - меняет визуал;
  - ставит физмат `Fireball` (`bounciness: 0.8`, `bounceCombine: Max`).

### 11.2 Water Droplet

- OnEquip: без доп. логики.
- Пассивно через материалы:
  - меняет визуал;
  - ставит физмат `WaterDroplet` (`bounciness: 0.5`, `bounceCombine: Average`).

### 11.3 Lucky Charm

- OnEquip: без доп. логики.
- На каждом `OnCollisionExit` шара:
  - `Multiplier = Random.Range(0.01f, 3.6f)`.
- Эффект очень нестабильный: множитель может резко как вырасти, так и упасть.

### 11.4 Curse of Anubis

- При активации:
  - `Lives = 0` (сброс множителя к `1.0`),
  - `Score /= 2`,
  - `Multiplier += 2.5` (обычно становится `3.5` сразу после активации),
  - яркость основного света падает до `0.25`.
- При снятии:
  - яркость света возвращается к `0.8`.
- Также меняет физмат/визуал/trail.

### 11.5 Angel Wings

- При активации для каждого шара:
  - обнуляет скорость и угловую скорость,
  - телепортирует шар к spawnpoint.
- Полезно для спасения сложной позиции.

### 11.6 Camera Flip

- При активации:
  - камера переворачивается (`z = 180`),
  - `Multiplier += 1.5`.
- При снятии:
  - камера возвращается в обычный угол.

### 11.7 Extra Ball

- При активации: спавнит дополнительный шар.
- Важный эффект: жизнь снимается только когда в поле не осталось **ни одного** шара, поэтому multi-ball повышает выживаемость.

### 11.8 Health Bonus

- При активации: `Lives += 1`.
- На каждом событии начисления очков (`OnScoring`):
  - шанс `1/50` (2%) дать еще `+1` жизнь.
- Важный нюанс: каждое изменение `Lives` сбрасывает множитель в `1.0`.

### 11.9 Ping Pong

- При активации усиливает флипперы:
  - `FlipperMotorVelocity: 1500 -> 2500`
  - `FlipperMotorForce: 150 -> 250`
- При снятии возвращает базовые значения.

### 11.10 Rock

- OnEquip: без доп. логики.
- Пассивно через физмат `Rock`:
  - `bounciness: 0`,
  - шар становится «тяжелее» по ощущению от отскоков.

### 11.11 Tennis Ball

- При активации:
  - `TiltChance: 5 -> 20`.
- Это означает, что шанс Tilt при толчке меняется с `20%` до `5%`.
- Также меняет физмат/визуал.

### 11.12 Ticket Prize

- При активации: сразу дает `Random.Range(3, 6)` => `3..5` тикетов.
- На каждом событии начисления очков:
  - шанс `1/10` (10%) на `+1` тикет.

## 12) Достижения (Achievements)

## 12.1 Что важно понимать

- У каждого достижения есть `Constraints` (предусловия).
- Если предусловия не выполнены, достижение не выдастся, даже если ты выполнил «основное» условие.
- Иконки достижений в UI часто скрыты, пока достижение не может быть получено.

### 12.2 Список достижений, условий и зависимостей

1. `Getting Started` (Common)
- Условие: начать первую игру.
- Предусловия: нет.

2. `Ticket Apprentice` (Common)
- Условие: получить первый тикет.
- Предусловия: `Getting Started`.

3. `Ticket Master` (Common)
- Условие: иметь 10 тикетов.
- Предусловия: `Getting Started`, `Ticket Apprentice`.

4. `Ticket Hoarder` (Rare)
- Условие: иметь 100 тикетов.
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Ticket Master`.

5. `Ticket Maniac` (Legendary)
- Условие: иметь 1000 тикетов.
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Ticket Master`, `Ticket Hoarder`.

6. `Gambling Newbie` (Common)
- Условие: купить первый ящик.
- Предусловия: `Getting Started`, `Ticket Apprentice`.

7. `Gambling Expert` (Common)
- Условие: купить первый Golden Crate.
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Gambling Newbie`.

8. `Gambling Tycoon` (Common)
- Условие: купить 3 Golden Crate подряд (счетчик подряд сбрасывается при покупке не-golden).
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Gambling Newbie`, `Gambling Expert`.

9. `Survivalist` (Common)
- Условие: достичь множителя `x3`.
- Предусловия: `Getting Started`.

10. `Ninja` (Rare)
- Условие: достичь множителя `x5`.
- Предусловия: `Getting Started`, `Survivalist`.

11. `Jackpot` (Common)
- Условие: в трех слотах инвентаря должны быть 3 одинаковых предмета (не `NoItem`).
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Gambling Newbie`.

12. `One of a Kind` (Rare)
- Условие: 3x `Curse of Anubis` в слотах.
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Gambling Newbie`, `Jackpot`.

13. `Straight Flush` (Common)
- Условие: 3x `Health Bonus` в слотах.
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Gambling Newbie`, `Jackpot`.

14. `Pinball Wizard` (Legendary)
- Условие: набрать `500000` очков в одной игре.
- Предусловия: `Getting Started`, `Ticket Apprentice`, `Gambling Newbie`, `Jackpot`, `Survivalist`, `Ninja`.

### 12.3 Нюансы по выдаче достижений

- `One of a Kind` и `Straight Flush` в коде требуют, чтобы `Jackpot` уже был получен.
- Если ты впервые собрал три одинаковых «особых» предмета, часто сначала откроется именно `Jackpot`, а специальное достижение придется повторить еще раз.

## 13) Сохранение прогресса

Сохраняется в `PlayerPrefs`:
- тикеты (`ticketCount`),
- содержимое 3 слотов (`Item0`, `Item1`, `Item2`),
- состояние достижений (ключи по именам достижений).

Не сохраняется между перезапусками:
- таблица `Recent Games` (она в runtime-памяти).

Кнопка `Reset progress`:
- делает `PlayerPrefs.DeleteAll()` и перезагружает сцену.

## 14) Практические подсказки

1. Для стабильного фарма тикетов держи шар в движении как можно дольше: множитель растет со временем и ускоряет набор очков.
2. Для безопасных толчков стола используй `Tennis Ball` (снижает шанс Tilt с 20% до 5%).
3. `Extra Ball` очень силен для выживаемости: проигрыш жизни только когда исчезли все шары.
4. `Health Bonus` полезен, но часто сбрасывает множитель (из-за изменения жизней).
5. Для `Gambling Tycoon` покупай только Golden подряд; любая Rusty/Brass покупка сбрасывает серию.
6. Для `Pinball Wizard` сначала закрой цепочку prerequisites (`Survivalist` + `Ninja` + `Jackpot` + базовые ачивки), иначе 500k могут не засчитаться сразу.
7. Для `One of a Kind` и `Straight Flush` сначала добейся обычного `Jackpot`, затем целенаправленно собирай нужные тройки.

---

Если нужно, могу сделать вторую версию этого же гайда в формате "короткая шпаргалка на 1 экран" (только цифры, формулы и оптимальные билды по предметам).
